<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra - Noskill Sensi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        
        :root {
            --bg-color: #f3f4f6;
            --card-color: #ffffff;
            --text-color: #11182b;
            --text-light: #6b7280;
            --border-color: #d1d5db;
            --primary-color: #059669; /* Verde de alta conversão */
            --primary-hover: #047857;
        }

        *, *:before, *:after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 480px;
            margin: 2rem auto;
            padding: 1rem;
        }

        .card {
            background-color: var(--card-color);
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-bottom: 1.5rem;
        }
        
        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin: 0 0 2rem 0;
        }

        /* Order Summary */
        .order-summary {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .product-image {
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            object-fit: cover;
        }
        .product-info {
            flex-grow: 1;
        }
        .product-name {
            font-weight: 600;
            margin: 0;
        }
        .price {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
        }
        .price-original {
            text-decoration: line-through;
            color: var(--text-light);
            font-size: 0.875rem;
        }
        .price-current {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.25rem;
        }

        /* Floating Labels */
        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(5, 150, 105, 0.3);
        }
        .form-label {
            position: absolute;
            left: 1rem;
            top: 0.85rem;
            color: var(--text-light);
            background-color: var(--card-color);
            padding: 0 0.25rem;
            transition: all 0.2s ease-out;
            pointer-events: none;
        }
        .form-input:focus + .form-label,
        .form-input:not(:placeholder-shown) + .form-label {
            top: -0.7rem;
            font-size: 0.75rem;
            color: var(--primary-color);
        }
        
        /* Payment Method */
        .payment-method {
            border: 2px solid var(--primary-color);
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: #f0fdf4;
        }
        .payment-method span {
            font-weight: 600;
        }
        .pix-icon {
            width: 24px;
            height: 24px;
        }
        
        /* CTA Button */
        .btn-cta {
            width: 100%;
            background-color: var(--primary-color);
            color: #fff;
            font-size: 1.125rem;
            font-weight: 700;
            padding: 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .btn-cta:hover {
            background-color: var(--primary-hover);
        }
        .btn-cta:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-cta svg {
            width: 20px;
            height: 20px;
        }
        
        /* Trust Badges */
        .trust-badges {
            margin-top: 2rem;
            text-align: center;
        }
        .badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: var(--text-light);
            font-size: 0.875rem;
        }
        .badge svg {
            width: 20px;
            height: 20px;
            color: var(--primary-color);
        }
        
        .footer {
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 2rem;
        }

        .hidden { display: none; }
        
        /* PIX Container Specific Styles */
        #pix-container {
            text-align: center;
        }
        #pix-qrcode {
            max-width: 240px;
            margin: 1.5rem auto;
            border: 4px solid var(--primary-color);
        }
        #pix-copy-paste {
            width: 100%;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            border-radius: 0.5rem;
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-light);
            resize: none;
        }
        #copy-button {
            width: 100%;
            margin-top: 1rem;
            background-color: #4b5563;
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #copy-button:hover {
            background-color: #1f2937;
        }
    </style>
</head>
<body>

    <div class="container">
        
        <div id="checkout-container">
            <div class="card">
                <h2>Finalizar Compra</h2>
            
                <div class="order-summary">
                    <img src="https://i.ibb.co/3yb2yj9z/JkOe9ya.png" alt="Noskill Sensi" class="product-image">
                    <div class="product-info">
                        <p class="product-name">Noskill Sensi - Plano Vitalício</p>
                        <div class="price">
                            <span class="price-original">R$ 29,90</span>
                            <span class="price-current">R$ 14,97</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <form id="checkout-form">
                    <div class="input-group">
                        <input type="email" id="email" class="form-input" placeholder=" " required>
                        <label for="email" class="form-label">E-mail</label>
                    </div>
                    <div class="input-group">
                        <input type="text" id="cpf" class="form-input" placeholder=" " required>
                        <label for="cpf" class="form-label">CPF</label>
                    </div>

                    <div class="payment-method">
                        <svg class="pix-icon" viewBox="0 0 256 256"><path fill="#32bcad" d="M128 0a128 128 0 1 0 128 128A128 128 0 0 0 128 0Zm62.41 180.41L128 118.06l-41.59-41.59a9.77 9.77 0 0 1-2.87-6.91h-23a9.77 9.77 0 0 1-9.77-9.76v-5.22h32.74v5.22a9.77 9.77 0 0 1-2.87 6.91L128 118.06l-41.59 41.59a9.77 9.77 0 0 1-6.91 2.87v23a9.77 9.77 0 0 1 9.76 9.77h5.22v-32.74h-5.22a9.77 9.77 0 0 1-6.91-2.87l41.59-41.59 41.59 41.59a9.77 9.77 0 0 1 6.91-2.87h23a9.77 9.77 0 0 1 9.77 9.76v5.22h-32.74v-5.22a9.77 9.77 0 0 1 2.87-6.91l.88-.88L149.53 160l21.41-21.41a9.77 9.77 0 0 1 6.91-2.87h23a9.77 9.77 0 0 1 9.76 9.76v5.22h-32.73v-5.22a9.77 9.77 0 0 1-2.87-6.91L128 84.47l-41.59 41.59a9.77 9.77 0 0 1-6.91 2.87h-23a9.77 9.77 0 0 1-9.77-9.76v-5.22h32.74v5.22a9.77 9.77 0 0 1-2.87 6.91l41.59 41.59 62.41 62.41Z"></path></svg>
                        <span>Pagar com <strong>PIX</strong></span>
                    </div>

                    <button type="submit" id="submit-button" class="btn-cta" style="margin-top: 1.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" /></svg>
                        <span id="button-text">PAGAR AGORA</span>
                    </button>
                </form>
            </div>
        </div>
        
        <div id="pix-container" class="card hidden">
            <h2 class="text-2xl font-bold text-center">Pague com PIX para Ativar</h2>
            <p class="text-center text-gray-500 mb-6">Escaneie o QR Code ou use o Copia e Cola.</p>
            <img id="pix-qrcode" src="" alt="PIX QR Code" class="rounded-lg mx-auto bg-white p-1">
            <textarea id="pix-copy-paste" class="mt-4" rows="3" readonly></textarea>
            <button id="copy-button">Copiar Código PIX</button>
            <p class="text-sm text-yellow-600 mt-6 animate-pulse">Aguardando pagamento...</p>
        </div>

        <div class="trust-badges">
            <div class="badge">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.008h-.008v-.008z" /></svg>
                <span>Compra segura com garantia</span>
            </div>
        </div>

        <p class="footer">
            © 2024 Noskill Sensi. Todos os direitos reservados.
        </p>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const checkoutContainer = document.getElementById('checkout-container');
            const pixContainer = document.getElementById('pix-container');
            const checkoutForm = document.getElementById('checkout-form');
            const submitButton = document.getElementById('submit-button');
            const buttonText = document.getElementById('button-text');
            const pixQrcode = document.getElementById('pix-qrcode');
            const pixCopyPaste = document.getElementById('pix-copy-paste');
            const copyButton = document.getElementById('copy-button');
            const cpfInput = document.getElementById('cpf');

            const API_BASE_URL = 'https://noskill-servidor.onrender.com';

            function setLoading(isLoading) {
                submitButton.disabled = isLoading;
                if (isLoading) {
                    buttonText.textContent = 'PROCESSANDO...';
                } else {
                    buttonText.textContent = 'PAGAR AGORA';
                }
            }
            
            function displayPixInfo({ qrcodeBase64, pixCopiaECola }) {
                pixQrcode.src = `data:image/png;base64,${qrcodeBase64}`;
                pixCopyPaste.value = pixCopiaECola;
                checkoutContainer.classList.add('hidden');
                pixContainer.classList.remove('hidden');
            }
            
            // Máscara de CPF
            cpfInput.addEventListener('input', (e) => {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
            });

            checkoutForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                setLoading(true);

                const email = document.getElementById('email').value;
                const cpf = document.getElementById('cpf').value;

                try {
                    const response = await fetch(`${API_BASE_URL}/criar-cobranca-pix`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ planName: 'Permanente', customerEmail: email, customerCpf: cpf })
                    });

                    const data = await response.json();
                    if (!response.ok) { throw new Error(data.error || 'Ocorreu um erro desconhecido.'); }
                    
                    displayPixInfo(data);

                } catch (error) {
                    alert('Erro ao gerar PIX: ' + error.message);
                } finally {
                    setLoading(false);
                }
            });
            
            copyButton.addEventListener('click', () => {
                pixCopyPaste.select();
                navigator.clipboard.writeText(pixCopyPaste.value).then(() => {
                    copyButton.textContent = 'Copiado com Sucesso!';
                    setTimeout(() => {
                        copyButton.textContent = 'Copiar Código PIX';
                    }, 2000);
                });
            });
        });
    </script>
</body>
</html>